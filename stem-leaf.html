<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplified Stem-and-Leaf Plot Lab</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for plot structure, highlights, and stats output */
        .plot-container { font-family: 'Inter', monospace; display: flex; flex-direction: column; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .plot-row { display: flex; border-bottom: 1px solid #e5e7eb; transition: background-color 0.2s; }
        .stem-column { width: 50px; padding: 6px 10px; text-align: right; font-weight: 700; color: #1f2937; background-color: #f3f4f6; position: relative; }
        .leaf-column { flex-grow: 1; padding: 6px 10px; word-wrap: break-word; word-break: break-all; letter-spacing: 0.5em; color: #374151; }
        .stem-column::after { content: ""; position: absolute; top: 0; right: 0; width: 2px; height: 100%; background-color: #4b5563; }
        .key-line { font-size: 0.875rem; margin-top: 8px; padding: 8px; border-radius: 0.5rem; background-color: #fef3c7; border: 1px dashed #fbbf24; }
        .correct-answer { background-color: #d1fae5; border-color: #10b981; }
        .incorrect-answer { background-color: #fee2e2; border-color: #ef4444; }
        .draggable-raw { cursor: grab; }
        /* Add hover effect for drop zones */
        .plot-row-dynamic:hover { background-color: #f8f8f8; }
    </style>
    <script>
        let currentPage = 0;
        const maxPages = 4; // Pages 0 (Intro), 1 (Builder), 2 (Analysis), 3 (Report)
        let currentBuilderData = []; // Stores the raw data set for the builder page's self-check
        let plotState = {}; // Stores { stem: [{value: 43, leaf: 3}, ...], ... }

        // SCORING TRACKERS
        let builderDataCompletion = [false, false, false, false]; // Tracks completion status for the 4 data sets
        let analysisScore = 0; // Tracks correct answers for Step 3 (Max 6)
        
        // Data sets for the D&D builder - UPDATED to ensure modes exist
        const dataSets = [
            { name: "1. Standard 2-Digit Scores (Mode: 27)", raw: [7, 8, 13, 15, 17, 22, 24, 25, 27, 27, 28, 32, 43] },
            { name: "2. 3-Digit Numbers (Mode: 102)", raw: [102, 108, 115, 72, 76, 85, 88, 89, 93, 97, 113, 102] },
            { name: "3. Decimals (Mode: 4.2)", raw: [3.1, 4.5, 5.7, 4.2, 3.4, 4.0, 5.1, 3.6, 4.2] },
            { name: "4. Mixed Small & Large (Mode: 25)", raw: [1, 2, 4, 11, 13, 14, 20, 21, 22, 23, 24, 25, 25] },
        ];
        
        // Correct answers for the final analysis challenge (Page 2 data)
        const analysisPlotData = [59, 62, 62, 65, 70, 75, 75, 78, 79, 81, 83, 88, 91, 95];
        const analysisAnswers = { min: 59, max: 95, range: 36, mode: "62, 75", median: 76.5, mean: 76.64 }; 
        
        // Pre-calculate analysis plot HTML once
        let analysisPlotHtml;


        function navigate(direction) {
            let newPage = currentPage + direction;
            if (newPage >= 0 && newPage < maxPages) { currentPage = newPage; showPage(currentPage); } 
            else if (newPage === maxPages) { currentPage = 0; showPage(currentPage); }
        }

        function parseData(input) {
            return input.split(',').map(s => s.trim()).filter(s => s !== '' && !isNaN(Number(s))).map(Number);
        }

        // --- CORE PLOTTING UTILITY ---
        function getStemLeaf(value) {
            value = Number(value);
            const str = value.toString();
            const decimalIndex = str.indexOf('.');
            const isDecimal = decimalIndex !== -1;

            if (isDecimal) {
                const parts = str.split('.');
                const stem = Number(parts[0]);
                const leaf = parts.length > 1 && parts[1].length > 0 ? Number(parts[1][0]) : 0;
                return { stem, leaf, fullValue: value };
            } else {
                const stem = Math.floor(value / 10) || 0;
                const leaf = value % 10;
                return { stem, leaf, fullValue: value };
            }
        }
        
        // --- DRAG AND DROP HANDLERS ---
        function handleDragStart(e) {
            const value = e.target.getAttribute('data-value');
            e.dataTransfer.setData('text/plain', value);
            e.dataTransfer.effectAllowed = 'move';
            e.target.classList.add('opacity-50', 'ring-4', 'ring-blue-400');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('opacity-50', 'ring-4', 'ring-blue-400');
        }

        function handleDragOver(e) {
            e.preventDefault();
            const draggedValue = e.dataTransfer.getData('text/plain');
            if (!draggedValue) return;

            const { stem: expectedStem } = getStemLeaf(draggedValue);
            const targetStem = Number(e.currentTarget.getAttribute('data-stem'));

            if (targetStem === expectedStem) {
                e.dataTransfer.dropEffect = 'move';
                e.currentTarget.classList.add('bg-blue-100');
            } else {
                e.dataTransfer.dropEffect = 'none';
                e.currentTarget.classList.add('bg-red-100');
            }
        }

        function handleDragLeave(e) {
             e.currentTarget.classList.remove('bg-blue-100', 'bg-red-100');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('bg-blue-100', 'bg-red-100');

            const draggedValue = e.dataTransfer.getData('text/plain');
            if (!draggedValue) return;

            const { stem, leaf } = getStemLeaf(draggedValue);
            const targetStem = Number(e.currentTarget.getAttribute('data-stem'));

            if (stem !== targetStem) { return; } 
            
            const draggable = document.querySelector(`.draggable-raw[data-value="${draggedValue}"]`);
            if (draggable) {
                draggable.classList.add('hidden');
                
                if (!plotState[stem]) plotState[stem] = [];
                
                if (plotState[stem].some(l => l.value === Number(draggedValue))) return;

                plotState[stem].push({ value: Number(draggedValue), leaf: leaf });
                plotState[stem].sort((a, b) => a.leaf - b.leaf); 
                
                renderPlotRow(stem);
            }
        }

        function handleDropBack(e) {
            e.preventDefault();
            const draggedValue = e.dataTransfer.getData('text/plain');
            if (!draggedValue) return;

            const { stem } = getStemLeaf(draggedValue);
            const draggable = document.querySelector(`.draggable-raw[data-value="${draggedValue}"]`);

            if (draggable) {
                if (plotState[stem]) {
                    plotState[stem] = plotState[stem].filter(l => l.value !== Number(draggedValue));
                    renderPlotRow(stem);
                }
                draggable.classList.remove('hidden');
            }
        }


        function renderPlotRow(stem) {
            const leafContainer = document.getElementById(`leaf-col-${stem}`);
            if (leafContainer) {
                if (plotState[stem] && plotState[stem].length > 0) {
                    leafContainer.textContent = plotState[stem].map(l => l.leaf).join('');
                } else {
                    leafContainer.textContent = '';
                }
            }
        }
        
        // --- STATISTICAL FUNCTIONS (Used for checking answers) ---
        function calculateStatistics(data) {
            const sortedData = [...data].sort((a, b) => a - b);
            const count = sortedData.length;
            if (count === 0) return {};

            const sum = sortedData.reduce((acc, val) => acc + val, 0);
            const mean = (sum / count).toFixed(2);
            const min = sortedData[0];
            const max = sortedData[count - 1];
            const range = max - min;

            let median;
            const middle = Math.floor(count / 2);
            if (count % 2 === 0) {
                median = ((sortedData[middle - 1] + sortedData[middle]) / 2).toFixed(1);
            } else {
                median = sortedData[middle].toFixed(1);
            }

            const counts = sortedData.reduce((acc, val) => { acc[val] = (acc[val] || 0) + 1; return acc; }, {});
            let maxCount = 0;
            let modes = [];
            for (const key in counts) {
                const currentCount = counts[key];
                if (currentCount > maxCount) {
                    maxCount = currentCount;
                    modes = [Number(key)];
                } else if (currentCount === maxCount && maxCount > 1) {
                    modes.push(Number(key));
                }
            }
            const mode = modes.length > 0 ? modes.sort((a, b) => a - b).join(', ') : 'None';

            return { min, max, range, mean, median, mode };
        }
        
        // --- PLOT STRUCTURE GENERATOR ---
        function generatePlot() {
            const selectedIndex = document.getElementById('data-set-select').value;
            const dataSet = dataSets[selectedIndex];
            currentBuilderData = [...dataSet.raw];
            
            plotState = {};
            resetInputs('builder');
            
            const rawDataContainer = document.getElementById('raw-data-container');
            rawDataContainer.innerHTML = '';
            
            // 1. Render raw data numbers as draggables (shuffled)
            const shuffledData = shuffleArray([...dataSet.raw]);
            shuffledData.forEach(value => {
                const div = document.createElement('div');
                div.textContent = value;
                div.className = 'draggable-raw p-2 border border-gray-400 bg-white rounded-lg shadow-sm cursor-grab text-center font-bold text-gray-800 transition hover:bg-yellow-50';
                div.setAttribute('draggable', 'true');
                div.setAttribute('data-value', value);
                div.addEventListener('dragstart', handleDragStart);
                div.addEventListener('dragend', handleDragEnd);
                rawDataContainer.appendChild(div);
            });

            // 2. Render the empty stem plot structure 
            const plotContainer = document.getElementById('plot-output-dnd');
            const keyDiv = document.getElementById('plot-key');
            plotContainer.innerHTML = '';
            
            if (dataSet.raw.length === 0) {
                plotContainer.innerHTML = '<p class="text-center text-gray-500 p-4">Data set is empty.</p>';
                keyDiv.innerHTML = '';
                return;
            }

            const minStem = getStemLeaf(Math.min(...dataSet.raw)).stem;
            const maxStem = getStemLeaf(Math.max(...dataSet.raw)).stem;
            
            let keyText = "";

            for (let stem = minStem; stem <= maxStem; stem++) {
                plotState[stem] = []; 
                
                const row = document.createElement('div');
                row.className = 'plot-row plot-row-dynamic';
                row.setAttribute('data-stem', stem);
                row.ondragover = handleDragOver;
                row.ondragleave = handleDragLeave;
                row.ondrop = handleDrop;
                
                const stemCol = document.createElement('div');
                stemCol.className = 'stem-column';
                stemCol.textContent = stem;

                const leafCol = document.createElement('div');
                leafCol.className = 'leaf-column';
                leafCol.id = `leaf-col-${stem}`;
                leafCol.textContent = '';

                row.appendChild(stemCol);
                row.appendChild(leafCol);
                plotContainer.appendChild(row);
                
                if (keyText === "") {
                     const firstValue = dataSet.raw.sort((a,b)=>a-b)[0];
                     const { stem: fs, leaf: fl } = getStemLeaf(firstValue);
                     keyText = `<span class="font-bold">${fs}</span> | <span class="font-bold">${fl}</span> = ${firstValue}`;
                }
            }
            
            keyDiv.innerHTML = `Key: ${keyText}`;
            document.getElementById('builder-check-message').innerHTML = '<p class="text-blue-600 mt-2">Plot structure ready! Drag all numbers to their correct Stem row.</p>';
        }

        // --- VALIDATION AND SCORING UTILITIES ---
        function resetInputs(prefix) {
            ['min', 'max', 'range', 'median', 'mode', 'mean'].forEach(stat => {
                const inputElement = document.getElementById(stat + `-${prefix}-input`); 
                if (inputElement && !inputElement.readOnly) { inputElement.value = ''; }
                if (inputElement) {
                    const container = inputElement.closest('.flex');
                    container.classList.remove('correct-answer', 'incorrect-answer', 'border-red-500', 'border-green-500');
                }
            });
            const messageEl = document.getElementById(`${prefix}-check-message`);
            if (messageEl) { messageEl.innerHTML = ''; }
        }
        
        function checkAnswers(prefix) {
            const isBuilder = prefix === 'builder';
            const dataToUse = isBuilder ? currentBuilderData : analysisPlotData; 
            
            const dataReady = dataToUse && dataToUse.length >= 2;
            const currentDataSetIndex = isBuilder ? Number(document.getElementById('data-set-select').value) : -1;
            
            // Check if all plot pieces are placed in the builder
            let allNumbersPlotted = false;
            if (isBuilder) {
                const totalPlotted = Object.values(plotState).reduce((sum, arr) => sum + arr.length, 0);
                allNumbersPlotted = totalPlotted === dataToUse.length;
            }

            if (isBuilder && !dataReady) {
                document.getElementById('builder-check-message').innerHTML = `<p class="text-red-600 mt-2">Please select a data set and click "Load Data" first!</p>`;
                return;
            }

            if (isBuilder && !allNumbersPlotted) {
                 document.getElementById('builder-check-message').innerHTML = `<p class="text-red-600 mt-2">Please drag all numbers into the plot before checking statistics.</p>`;
                 return;
            }
            
            const correctAnswers = isBuilder ? calculateStatistics(dataToUse) : analysisAnswers;
            const messageId = `${prefix}-check-message`;
            let allStatsCorrect = true;
            let correctStatCount = 0;

            ['min', 'max', 'range', 'median', 'mode', 'mean'].forEach(stat => {
                const inputId = `${stat}-${prefix}-input`;
                const inputElement = document.getElementById(inputId); 
                if (!inputElement) return;

                const value = inputElement.value.trim(); 
                const container = inputElement.closest('.flex');
                let isCorrect = false;
                let expectedAnswer = correctAnswers[stat].toString();

                if (stat === 'mode') {
                    const userModes = value.split(/,\s*|\s+/).map(s => s.trim()).filter(s => s !== '').map(Number).sort().join(',');
                    const expectedModes = expectedAnswer.split(/,\s*/).map(Number).sort().join(',');
                    isCorrect = userModes === expectedModes;
                } else if (stat === 'median' || stat === 'mean') {
                     isCorrect = value === expectedAnswer; 
                } else {
                    const numValue = Number(value);
                    const expectedNum = Number(expectedAnswer);
                    isCorrect = !isNaN(numValue) && Math.abs(numValue - expectedNum) < 0.01;
                }

                container.classList.toggle('correct-answer', isCorrect); 
                container.classList.toggle('incorrect-answer', !isCorrect);
                
                if (isCorrect) {
                    correctStatCount++;
                } else if (!inputElement.readOnly) { 
                    allStatsCorrect = false; 
                }
            });

            // --- SCORING UPDATES ---
            if (isBuilder && allStatsCorrect) {
                 // Mark the specific dataset as complete
                 builderDataCompletion[currentDataSetIndex] = true;
            } else if (!isBuilder) {
                 // Update the score for the final analysis challenge
                 analysisScore = correctStatCount;
            }

            const resultMessage = document.getElementById(messageId);
            if (allStatsCorrect) {
                resultMessage.innerHTML = `<p class="text-green-700 font-bold mt-4">✅ All Correct! Data Set ${currentDataSetIndex + 1} Mastered.</p>`;
            } else {
                resultMessage.innerHTML = `<p class="text-red-700 mt-4">❌ Keep trying! Review your calculations and try again.</p>`;
            }
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function calculateFinalScore() {
            const builderPoints = builderDataCompletion.filter(c => c).length;
            const analysisPoints = analysisScore;
            const totalPoints = builderPoints + (analysisPoints / 6) * 6; // max 6 points

            document.getElementById('builder-score-out').textContent = `${builderPoints} / ${dataSets.length}`;
            document.getElementById('analysis-score-out').textContent = `${analysisScore} / 6`;
            document.getElementById('total-score-out').textContent = `${Math.round(totalPoints)} / 10`;

            const message = document.getElementById('final-message');
            if (totalPoints === 10) {
                 message.innerHTML = '<span class="text-green-700 font-extrabold">🎉 Congratulations! Flawless mastery of Stem-and-Leaf Plots.</span>';
            } else if (totalPoints >= 7) {
                 message.innerHTML = '<span class="text-blue-700 font-extrabold">Great Job! You\'ve achieved high mastery. Consider re-attempting unfinished sections.</span>';
            } else {
                 message.innerHTML = '<span class="text-yellow-700 font-extrabold">Keep Practicing. Review the definitions of Median, Mode, and Mean, and try the challenges again.</span>';
            }
        }

        // --- PAGE NAVIGATION ---
        
        function showPage(index) {
            document.querySelectorAll('.page-content').forEach(d => d.classList.add('hidden'));
            const pageEl = document.getElementById(`page-${index}`); if (!pageEl) return;
            pageEl.classList.remove('hidden');

            const prevBtn = pageEl.querySelector('.page-prev-btn'); const nextBtn = pageEl.querySelector('.page-next-btn');
            
            if (index === 1) {
                // Initialize dropdown options on builder page load
                const select = document.getElementById('data-set-select');
                if (select.children.length === 0) {
                     dataSets.forEach((set, i) => {
                        const option = document.createElement('option');
                        option.value = i;
                        option.textContent = set.name;
                        select.appendChild(option);
                    });
                     if (currentBuilderData.length === 0) generatePlot(); 
                }
                const rawDataContainer = document.getElementById('raw-data-container');
                rawDataContainer.ondragover = (e) => e.preventDefault();
                rawDataContainer.ondrop = handleDropBack;
            } else if (index === 2) {
                 // Set analysis plot data on analysis page load
                if (!analysisPlotHtml) analysisPlotHtml = createPlot(analysisPlotData);
                document.getElementById('analysis-plot-output').innerHTML = `<div class="plot-container rounded-xl">${analysisPlotHtml.html}</div>`;
                document.getElementById('analysis-key').innerHTML = `Key: ${analysisPlotHtml.key}`;
                resetInputs('analysis');
            } else if (index === 3) {
                 // Calculate and display final scores
                 calculateFinalScore();
            }

            if (prevBtn) { prevBtn.onclick = () => navigate(-1); prevBtn.classList.toggle('invisible', index === 0); }
            if (nextBtn) {
                nextBtn.disabled = false; nextBtn.onclick = () => navigate(1); 
                nextBtn.textContent = (index === maxPages - 1) ? 'Start Over' : 'Next Step →';
            }
        }

        window.onload = () => {
            document.getElementById('generate-plot-btn').addEventListener('click', generatePlot);
            document.getElementById('check-builder-btn').addEventListener('click', () => checkAnswers('builder'));
            document.getElementById('check-analysis-btn').addEventListener('click', () => checkAnswers('analysis'));
            document.getElementById('data-set-select').addEventListener('change', generatePlot);
            showPage(currentPage);
        };
    </script>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8 font-[Inter] text-gray-800">
    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-blue-700 tracking-tight">Stem-and-Leaf Plot Lab (D&D Edition)</h1>
            <p class="text-xl text-gray-600 mt-2">Build Plots & Analyze Key Statistics</p>
        </header>
        
        <!-- PAGE 0: INTRODUCTION & CORE PROCESS -->
        <div id="page-0" class="page-content">
            <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border-t-4 border-blue-500">
                <h2 class="text-3xl font-bold mb-4 text-blue-700">Step 1: The Core Rule</h2>
                <p class="mb-6 text-gray-600">A **Stem-and-Leaf Plot** separates a data point into two parts: the **Stem** (leading digit/digits) and the **Leaf** (always the single, final digit).</p>
                <div class="flex justify-around items-center text-center p-4 mt-6 bg-yellow-100 border border-yellow-300 rounded-lg">
                    <div class="space-y-1"><p class="text-xl font-bold text-blue-700">STEM: 8</p><p class="text-sm text-gray-600">(Leading Digits)</p></div>
                    <div class="text-3xl font-bold text-gray-500 py-2 sm:py-0">+</div>
                    <div class="space-y-1"><p class="text-xl font-bold text-red-700">LEAF: 3</p><p class="text-sm text-gray-600">(Final Digit)</p></div>
                    <div class="text-3xl font-bold text-gray-500 py-2 sm:py-0">→</div>
                    <div class="space-y-1"><p class="text-3xl font-extrabold text-gray-900">83</p><p class="text-sm text-gray-600">(Data Point)</p></div>
                </div>
                <h3 class="font-extrabold text-xl mt-6 mb-3 text-gray-900">The Construction Requirements</h3>
                <ul class="list-disc list-inside text-lg font-medium space-y-2 p-4 bg-gray-100 rounded-lg">
                    <li>**Order the Data:** Numbers must be sorted from smallest to largest.</li>
                    <li>**Plot Leaves:** Leaves must be listed in **ascending order** for each stem.</li>
                    <li>**Create the Key:** The plot must include a key (e.g., $3|1 = 31$) to define the place value.</li>
                </ul>
                <div class="flex justify-end items-center mt-6 pt-4 border-t border-gray-200">
                    <button class="page-next-btn bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 shadow-md">Next Step →</button>
                </div>
            </div>
        </div>

        <!-- PAGE 1: DRAG AND DROP BUILDER & STATS (Self-Check) -->
        <div id="page-1" class="page-content hidden">
            <section class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border-t-4 border-blue-500">
                <h2 class="text-3xl font-bold mb-4 text-blue-700">Step 2: Plot Builder (Drag & Drop)</h2>
                <p class="mb-4 text-gray-600">Select a data set, then **drag each raw number** from the container below to its correct **Stem row** to construct the plot. Then, manually calculate the statistics.</p>
                
                <div class="space-y-4 mb-6">
                    <label for="data-set-select" class="font-bold text-gray-700 block">Choose a Data Set to Build:</label>
                    <div class="flex gap-2">
                        <select id="data-set-select" class="flex-grow p-3 border-2 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <!-- Options populated by JS -->
                        </select>
                        <button id="generate-plot-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 shadow-md">
                            Load Data
                        </button>
                    </div>
                </div>

                <div class="mt-4 border p-4 rounded-xl bg-gray-50">
                    <h3 class="text-xl font-semibold mb-3 text-center text-gray-900">Raw Data Pool (Drag these numbers)</h3>
                    <div id="raw-data-container" class="min-h-[6rem] p-3 border-2 border-dashed border-gray-400 rounded-lg flex flex-wrap gap-2 justify-center content-start">
                        <!-- Draggable numbers populated by JS -->
                    </div>
                </div>

                <div class="mt-8 border p-4 rounded-xl bg-gray-50 flex flex-col lg:flex-row gap-6">
                    <!-- Plot Output -->
                    <div class="lg:w-1/3">
                        <h3 class="text-xl font-semibold mb-3 text-center text-gray-900">Stem-and-Leaf Plot</h3>
                        <div id="plot-output-dnd" class="plot-container rounded-xl shadow-xl">
                             <p class="text-center text-gray-500 p-4">Click "Load Data" to begin plotting.</p>
                        </div>
                        <p id="plot-key" class="key-line text-center"></p>
                    </div>

                    <!-- Stats Input for Self-Check -->
                    <div class="lg:w-2/3 border-t lg:border-t-0 lg:border-l border-gray-300 lg:pl-6 pt-4 lg:pt-0">
                        <h3 class="text-xl font-semibold mb-3 text-center text-gray-900">Calculate & Check Statistics</h3>
                        <div id="stats-output" class="space-y-3">
                            <div class="flex items-center space-x-3 border-2 border-gray-300 rounded-lg p-2 bg-white transition duration-150"><label for="min-builder-input" class="w-24 font-medium">Minimum:</label><input type="number" id="min-builder-input" placeholder="Min" class="flex-1 p-1 border-gray-200 rounded text-right"></div>
                            <div class="flex items-center space-x-3 border-2 border-gray-300 rounded-lg p-2 bg-white transition duration-150"><label for="max-builder-input" class="w-24 font-medium">Maximum:</label><input type="number" id="max-builder-input" placeholder="Max" class="flex-1 p-1 border-gray-200 rounded text-right"></div>
                            <div class="flex items-center space-x-3 border-2 border-gray-300 rounded-lg p-2 bg-white transition duration-150"><label for="range-builder-input" class="w-24 font-medium">Range:</label><input type="number" id="range-builder-input" placeholder="Range" class="flex-1 p-1 border-gray-200 rounded text-right"></div>
                            <div class="flex items-center space-x-3 border-2 border-gray-300 rounded-lg p-2 bg-white transition duration-150"><label for="mode-builder-input" class="w-24 font-medium">Mode(s):</label><input type="text" id="mode-builder-input" placeholder="e.g., 62, 75" class="flex-1 p-1 border-gray-200 rounded text-right"></div>
                            <div class="flex items-center space-x-3 border-2 border-gray-300 rounded-lg p-2 bg-white transition duration-150"><label for="median-builder-input" class="w-24 font-medium">Median:</label><input type="number" step="0.01" id="median-builder-input" placeholder="Median" class="flex-1 p-1 border-gray-200 rounded text-right"></div>
                            <div class="flex items-center space-x-3 border-2 border-gray-300 rounded-lg p-2 bg-white transition duration-150"><label for="mean-builder-input" class="w-24 font-medium">Mean:</label><input type="number" step="0.01" id="mean-builder-input" placeholder="Mean" class="flex-1 p-1 border-gray-200 rounded text-right"></div>
                        </div>
                        <button id="check-builder-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-150 shadow-md mt-4">
                            Check My Answers
                        </button>
                        <div id="builder-check-message" class="text-center font-medium"></div>
                    </div>
                </div>

                <div class="flex justify-between items-center mt-6 pt-4 border-t border-gray-200">
                    <button class="page-prev-btn flex items-center text-gray-700 hover:text-indigo-600 transition duration-150"><svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>← Previous Step</button>
                    <button class="page-next-btn bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 shadow-md">Next Step →</button>
                </div>
            </section>
        </div>


        <!-- PAGE 2: INTERPRETATION PRACTICE (OLD PAGE 7) -->
        <div id="page-2" class="page-content hidden">
            <section class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border-t-4 border-blue-500">
                <h2 class="text-3xl font-bold mb-4 text-blue-700">Step 3: Interpretation Challenge</h2>
                <p class="mb-4 text-gray-600">Analyze the plot of Math Test Scores (out of 100) below. Calculate the key data landmarks and enter your answers. Min and Max are provided to save time.</p>
                
                <div class="flex flex-col sm:flex-row gap-6 mb-6">
                    <!-- Analysis Plot -->
                    <div class="sm:w-1/2">
                        <h3 class="text-xl font-semibold mb-3 text-center text-gray-900">Math Test Scores Plot</h3>
                        <div id="analysis-plot-output">
                            <!-- Plot generated dynamically on showPage -->
                        </div>
                        <p id="analysis-key" class="key-line text-center"></p>
                    </div>

                    <!-- Input Fields -->
                    <div class="sm:w-1/2 space-y-3">
                        <h3 class="text-xl font-semibold mb-3 text-center text-gray-900">Enter Landmarks</h3>
                        <div class="flex items-center space-x-3 border-2 border-gray-300 rounded-lg p-2 bg-white transition duration-150"><label for="min-analysis-input" class="w-24 font-medium">Minimum:</label><input type="number" id="min-analysis-input" placeholder="Min" class="flex-1 p-1 border-gray-200 rounded text-right" value="59" readonly></div>
                        <div class="flex items-center space-x-3 border-2 border-gray-300 rounded-lg p-2 bg-white transition duration-150"><label for="max-analysis-input" class="w-24 font-medium">Maximum:</label><input type="number" id="max-analysis-input" placeholder="Max" class="flex-1 p-1 border-gray-200 rounded text-right" value="95" readonly></div>
                        <div class="flex items-center space-x-3 border-2 border-gray-300 rounded-lg p-2 bg-white transition duration-150"><label for="range-analysis-input" class="w-24 font-medium">Range:</label><input type="number" id="range-analysis-input" placeholder="Range" class="flex-1 p-1 border-gray-200 rounded text-right"></div>
                        <div class="flex items-center space-x-3 border-2 border-gray-300 rounded-lg p-2 bg-white transition duration-150"><label for="mode-analysis-input" class="w-24 font-medium">Mode(s):</label><input type="text" id="mode-analysis-input" placeholder="e.g., 62, 75" class="flex-1 p-1 border-gray-200 rounded text-right"></div>
                        <div class="flex items-center space-x-3 border-2 border-gray-300 rounded-lg p-2 bg-white transition duration-150"><label for="median-analysis-input" class="w-24 font-medium">Median:</label><input type="number" step="0.5" id="median-analysis-input" placeholder="Median" class="flex-1 p-1 border-gray-200 rounded text-right"></div>
                        <div class="flex items-center space-x-3 border-2 border-gray-300 rounded-lg p-2 bg-white transition duration-150"><label for="mean-analysis-input" class="w-24 font-medium">Mean:</label><input type="number" step="0.01" id="mean-analysis-input" placeholder="Mean" class="flex-1 p-1 border-gray-200 rounded text-right"></div>
                        <button id="check-analysis-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-150 shadow-md">
                            Check My Answers
                        </button>
                        <div id="analysis-check-message" class="text-center font-medium"></div>
                    </div>
                </div>
                
                <div class="flex justify-between items-center mt-6 pt-4 border-t border-gray-200">
                    <button class="page-prev-btn flex items-center text-gray-700 hover:text-indigo-600 transition duration-150"><svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>← Previous Step</button>
                    <button class="page-next-btn bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 shadow-md">Next Step →</button>
                </div>
            </section>
        </div>
        
        <!-- PAGE 3: FINAL REPORT -->
        <div id="page-3" class="page-content hidden">
            <section class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border-t-4 border-green-500">
                <h2 class="text-3xl font-bold mb-4 text-green-700">Step 4: Mastery Report</h2>
                <p class="mb-6 text-gray-600">Review your overall performance on plot construction and statistical interpretation.</p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <p class="text-sm text-blue-700 font-medium">Plotting Mastery (Step 2)</p>
                        <h3 class="text-4xl font-extrabold text-blue-900 mt-2" id="builder-score-out">-- / 4</h3>
                        <p class="text-sm text-gray-600 mt-1">Data Sets Completed</p>
                    </div>
                     <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                        <p class="text-sm text-green-700 font-medium">Interpretation Score (Step 3)</p>
                        <h3 class="text-4xl font-extrabold text-green-900 mt-2" id="analysis-score-out">-- / 6</h3>
                        <p class="text-sm text-gray-600 mt-1">Statistics Correct</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                        <p class="text-sm text-yellow-700 font-medium">Total Overall Score</p>
                        <h3 class="text-4xl font-extrabold text-yellow-900 mt-2" id="total-score-out">-- / 10</h3>
                        <p class="text-sm text-gray-600 mt-1">Total Points Earned</p>
                    </div>
                </div>
                
                <div id="final-message" class="text-center text-xl font-semibold mt-8 p-4 bg-gray-100 rounded-lg">
                    <!-- Final status message goes here -->
                </div>

                <div class="flex justify-between items-center mt-6 pt-4 border-t border-gray-200">
                    <button class="page-prev-btn flex items-center text-gray-700 hover:text-indigo-600 transition duration-150"><svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>← Previous Step</button>
                    <button class="page-next-btn bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 shadow-md">Start Over</button>
                </div>
            </section>
        </div>
    </div>
</body>
</html>
