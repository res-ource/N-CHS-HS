<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxes 101: An Interactive Lesson</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Tailwind's gray-100 */
        }
        .lesson-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            margin-bottom: 2rem;
            padding: 2rem;
            display: none; /* Hidden by default */
        }
        .active-card {
            display: block;
        }
        .interactive-section {
            border: 1px solid #e2e8f0; /* gray-200 */
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
            background-color: #f8fafc; /* gray-50 */
        }
        .quiz-option {
            cursor: pointer;
            border: 2px solid transparent;
        }
        .quiz-option.selected {
            border-color: #3b82f6; /* blue-500 */
            background-color: #dbeafe; /* blue-100 */
        }
        .quiz-option.correct {
            border-color: #22c55e; /* green-500 */
            background-color: #dcfce7; /* green-100 */
        }
        .quiz-option.incorrect {
            border-color: #ef4444; /* red-500 */
            background-color: #fee2e2; /* red-100 */
        }
        .nav-button {
            background-color: #3b82f6;
            color: white;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
        }
        .nav-button:hover {
            background-color: #2563eb;
        }
        .nav-button.secondary {
            background-color: #e2e8f0;
            color: #475569;
        }
        .nav-button.secondary:hover {
            background-color: #cbd5e1;
        }
        .persona-tab {
            background-color: #e2e8f0; /* gray-200 */
            color: #475569; /* gray-600 */
        }
        .persona-tab:hover {
            background-color: #cbd5e1; /* gray-300 */
        }
        .persona-tab.active {
            background-color: #3b82f6; /* blue-500 */
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-3xl">
        <!-- Progress Bar -->
        <div class="mb-4">
            <div class="flex justify-between mb-1">
                <span class="text-base font-medium text-blue-700">Lesson Progress</span>
                <span id="progress-text" class="text-sm font-medium text-blue-700">Step 1 of 11</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2.5">
                <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 9.09%"></div>
            </div>
        </div>

        <!-- Lesson Cards Container -->
        <div id="lesson-container">
            <!-- Card 0: Introduction -->
            <section class="lesson-card" data-step="0">
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-gray-900">Welcome to Taxes 101!</h2>
                    <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">This lesson will walk you through the essentials of taxes, from your paycheck to filing your first return.</p>
                    <p class="mt-2 text-gray-600">Click "Start" to begin.</p>
                </div>
            </section>

            <!-- Card 1: Why This Matters -->
            <section class="lesson-card" data-step="1">
                <h3 class="text-2xl font-semibold mb-4 text-gray-900">Why Should You Care About Taxes?</h3>
                <div class="space-y-4 text-gray-700">
                    <p>Taxes might seem boring, but understanding them is a real-life superpower. This isn't just about rules; it's about <span class="font-bold">keeping more of your hard-earned money</span>. Knowing how taxes work means you can get back every dollar you're owed in refunds and avoid costly penalties.</p>
                    <div>
                        <h4 class="font-semibold text-lg text-red-600">What Happens If You Don't Understand This?</h4>
                        <ul class="list-disc list-inside mt-2 space-y-1">
                            <li>You could <span class="font-medium">lose money</span> to penalties and interest on late or incorrect filings.</li>
                            <li>You might <span class="font-medium">miss out on a tax refund</span>, which is your own money the government owes you back.</li>
                            <li>You become an easier <span class="font-medium">target for financial scams</span> that prey on confusion about the IRS.</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-gray-800">Real-World Consequences</h4>
                        <p class="mt-2">History is full of famous athletes and celebrities who lost millions—and sometimes their freedom—because they ignored their taxes or trusted the wrong people. For everyday people, a simple mistake can lead to a surprise bill from the IRS that takes years to pay off. Learning this now puts <span class="font-bold">you in control</span> and protects your financial future.</p>
                    </div>
                </div>
            </section>

            <!-- Card 2: Payroll Taxes -->
            <section id="part1" class="lesson-card" data-step="2">
                <h3 class="text-2xl font-semibold mb-4 text-gray-900">Part 1: Payroll Taxes</h3>
                <p class="mb-4">Your "gross pay" is your total earning, but your "net pay" is what you take home. The difference is taxes and other deductions. Click the profiles below to see how this works for different people.</p>
                
                <div class="interactive-section">
                    <h4 class="font-semibold text-lg mb-4 text-center">See It in Action: Four Paycheck Stories</h4>
                    <div id="persona-tabs-payroll" class="grid grid-cols-2 lg:grid-cols-4 gap-2 mb-4">
                        <button data-persona="student" class="persona-tab p-3 text-sm font-medium rounded-lg transition">Student Worker</button>
                        <button data-persona="cashier" class="persona-tab p-3 text-sm font-medium rounded-lg transition">Full-Time Cashier</button>
                        <button data-persona="salary" class="persona-tab p-3 text-sm font-medium rounded-lg transition">Salaried Employee</button>
                        <button data-persona="professional" class="persona-tab p-3 text-sm font-medium rounded-lg transition">High Earner</button>
                    </div>
                    <div id="persona-content-payroll" class="p-4 bg-white rounded-lg min-h-[120px] relative">
                        <!-- Persona content will be injected here by JS -->
                    </div>
                </div>

                <div class="interactive-section mt-6">
                    <h4 class="font-semibold text-lg mb-2">Paycheck Estimator</h4>
                    <p class="text-sm mb-4 text-gray-600">Click a profile above to pre-fill the weekly pay, then click Calculate.</p>
                    <div id="paycheck-error" class="text-red-600 text-sm font-medium mb-2 hidden">Please enter a positive number for gross pay.</div>
                    <div class="flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4">
                        <div class="w-full sm:w-auto">
                            <label for="grossPay" class="font-medium">Weekly Gross Pay: $</label>
                            <input type="number" id="grossPay" class="w-32 p-2 border border-gray-300 rounded-md" placeholder="500">
                        </div>
                        <button id="calculatePay" class="w-full sm:w-auto bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition">Calculate</button>
                    </div>
                    <div id="paycheckResult" class="mt-4 p-4 bg-white rounded-lg shadow-inner hidden">
                        <h5 class="font-bold text-lg">Estimated Pay Stub</h5>
                        <div class="space-y-2 mt-2">
                            <div class="flex justify-between"><span>Gross Pay:</span> <span id="resultGross"></span></div>
                            <div class="flex justify-between text-red-600"><span>- Social Security (6.2%):</span> <span id="resultSS"></span></div>
                            <div class="flex justify-between text-red-600"><span>- Medicare (1.45%):</span> <span id="resultMedicare"></span></div>
                            <div class="flex justify-between text-red-600"><span>- Federal Tax (Est.):</span> <span id="resultFed"></span></div>
                            <div class="flex justify-between text-red-600"><span>- State Tax (Est. 4%):</span> <span id="resultState"></span></div>
                            <hr class="my-2">
                            <div class="flex justify-between font-bold text-green-600 text-xl"><span>Net (Take-Home) Pay:</span> <span id="resultNet"></span></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Card 3: Tax Forms -->
            <section id="part2" class="lesson-card" data-step="3">
                <h3 class="text-2xl font-semibold mb-4 text-gray-900">Part 2: The Story of Your Tax Forms</h3>
                <p class="mb-4 text-gray-600">Don't let the strange numbers scare you. Each tax form just tells a small part of a simple story about your money. Let's break it down.</p>
                
                <div class="space-y-6 mt-6">
                     <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h4 class="font-bold text-lg text-blue-800">Form W-4: The Instruction Slip</h4>
                        <p class="mt-1"><span class="font-semibold">Its Job:</span> To tell your employer how much money to set aside from each paycheck for taxes.</p>
                        <p class="mt-2 text-sm text-gray-700"><span class="font-semibold">Simple Analogy:</span> You tell your boss, "Please hold onto this part of my pay for taxes." You want this guess to be as accurate as possible.</p>
                    </div>
                    <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <h4 class="font-bold text-lg text-yellow-800">Form W-2: The Yearly Scorecard</h4>
                        <p class="mt-1"><span class="font-semibold">Its Job:</span> Your employer gives this to you. It's an official summary of how much you earned and how much you already paid in taxes for the year.</p>
                        <p class="mt-2 text-sm text-gray-700"><span class="font-semibold">Simple Analogy:</span> At the end of the year, your boss gives you a receipt that says, "Here's what you earned and here's what we sent to the IRS for you."</p>
                    </div>
                    <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                        <h4 class="font-bold text-lg text-green-800">Form 1040: The Final Settle-Up</h4>
                        <p class="mt-1"><span class="font-semibold">Its Job:</span> This is the form you send to the IRS. You use the numbers from your W-2 to figure out your exact tax bill and see if you get a refund or owe more.</p>
                        <p class="mt-2 text-sm text-gray-700"><span class="font-semibold">Simple Analogy:</span> This is you "settling the bill" with the IRS. You compare your final, official tax amount with what you've already paid to see if you get money back or need to pay a bit more.</p>
                    </div>
                </div>
            
                <div class="interactive-section mt-8">
                    <h4 class="font-semibold text-lg mb-4 text-center">Visualizing the Forms</h4>
                    <div class="flex flex-col sm:flex-row justify-around items-center gap-6 text-center">
                        <!-- W-4 Icon -->
                        <div class="flex-1">
                            <div class="bg-blue-100 p-4 rounded-full w-24 h-24 mx-auto flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </div>
                            <h5 class="font-bold mt-3">Form W-4</h5>
                            <p class="text-sm text-gray-600">(The Instruction Slip)</p>
                        </div>
                        <!-- W-2 Icon -->
                        <div class="flex-1">
                            <div class="bg-yellow-100 p-4 rounded-full w-24 h-24 mx-auto flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                            </div>
                            <h5 class="font-bold mt-3">Form W-2</h5>
                            <p class="text-sm text-gray-600">(The Scorecard)</p>
                        </div>
                        <!-- 1040 Icon -->
                        <div class="flex-1">
                            <div class="bg-green-100 p-4 rounded-full w-24 h-24 mx-auto flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                </svg>
                            </div>
                            <h5 class="font-bold mt-3">Form 1040</h5>
                            <p class="text-sm text-gray-600">(The Settle-Up)</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Card 4: Standard Deduction -->
            <section class="lesson-card" data-step="4">
                <h3 class="text-2xl font-semibold mb-4 text-gray-900">The Magic Zero-Tax Zone: Standard Deduction</h3>
                <p class="mb-4">Before any tax brackets apply, you get to reduce your income by a set amount. This is called the <span class="font-bold">Standard Deduction</span>.</p>
                <div class="interactive-section text-center">
                    <p class="text-lg text-gray-700">For a single person in 2025, the Standard Deduction is about:</p>
                    <p class="text-5xl font-bold text-green-600 my-4">$14,600</p>
                    <p class="text-gray-800">This means your first <span class="font-semibold">$14,600</span> of income is taxed at <span class="font-semibold">0%</span>. If you earn less than this, you typically won't owe any federal income tax!</p>
                </div>
                <p class="mt-4 text-sm text-center text-gray-600">Think of it as a head start from the government before they start taxing you.</p>
            </section>

            <!-- Card 5: Tax Brackets -->
            <section id="part3" class="lesson-card" data-step="5">
                <h3 class="text-2xl font-semibold mb-4 text-gray-900">Part 4: How Tax Brackets *Really* Work</h3>
                <p class="mb-4">The tax brackets apply to your income *after* the standard deduction. Click a profile below to see how their income fills the tax brackets.</p>
                <div class="interactive-section">
                    <h4 class="font-semibold text-lg mb-4 text-center">See It in Action: Tax Brackets for Different Workers</h4>
                    <div id="persona-tabs-brackets" class="grid grid-cols-2 lg:grid-cols-4 gap-2 mb-4">
                        <button data-persona="student" class="persona-tab p-3 text-sm font-medium rounded-lg transition">Student Worker</button>
                        <button data-persona="cashier" class="persona-tab p-3 text-sm font-medium rounded-lg transition">Full-Time Cashier</button>
                        <button data-persona="salary" class="persona-tab p-3 text-sm font-medium rounded-lg transition">Salaried Employee</button>
                        <button data-persona="professional" class="persona-tab p-3 text-sm font-medium rounded-lg transition">High Earner</button>
                    </div>
                    <div class="mt-4">
                        <label for="incomeSlider" class="font-medium">Annual Income: $<span id="incomeValue">7800</span></label>
                        <input type="range" id="incomeSlider" min="0" max="150000" step="100" value="7800" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="mt-4 flex flex-wrap gap-4" id="taxBracketsViz"></div>
                    <div class="mt-4 p-4 bg-white rounded-lg shadow-inner">
                        <h5 class="font-bold text-lg">Estimated Tax Bill</h5>
                        <div class="flex justify-between mt-2"><span>Total Estimated Tax:</span> <span id="totalTax"></span></div>
                        <div class="flex justify-between font-bold"><span>Effective Tax Rate:</span> <span id="effectiveRate"></span></div>
                    </div>
                </div>
            </section>

            <!-- Card 6: Deductions & Credits -->
            <section id="part4" class="lesson-card" data-step="6">
                <h3 id="deductions-title" class="text-2xl font-semibold mb-4 text-gray-900">Part 5: Deductions & Credits</h3>
                <p class="mb-4">A <span class="font-semibold">deduction</span> reduces your taxable income (makes the pie smaller). A <span class="font-semibold">credit</span> is a dollar-for-dollar reduction of your final tax bill (like a coupon). <span class="font-bold">Credits are more powerful.</span></p>
                
                <div class="interactive-section">
                    <h4 class="font-semibold text-lg mb-4 text-center">Compare the Impact for Different Workers</h4>
                    <div id="persona-tabs-deductions" class="grid grid-cols-2 lg:grid-cols-4 gap-2 mb-4">
                        <button data-persona="student" class="persona-tab p-3 text-sm font-medium rounded-lg transition">Student Worker</button>
                        <button data-persona="cashier" class="persona-tab p-3 text-sm font-medium rounded-lg transition">Full-Time Cashier</button>
                        <button data-persona="salary" class="persona-tab p-3 text-sm font-medium rounded-lg transition">Salaried Employee</button>
                        <button data-persona="professional" class="persona-tab p-3 text-sm font-medium rounded-lg transition">High Earner</button>
                    </div>
                     <div id="deductions-persona-content" class="p-4 bg-white rounded-lg min-h-[220px] relative">
                        <!-- Deductions persona content will be injected here by JS -->
                    </div>
                </div>
            </section>

            <!-- Card 7: Filing Your Taxes -->
            <section id="part5" class="lesson-card" data-step="7">
                <h3 class="text-2xl font-semibold mb-4 text-gray-900">Part 6: Knowledge Check!</h3>
                <p>Filing is how you "settle up" with the IRS each year. Let's see what you've learned.</p>
                <div class="interactive-section">
                    <h4 class="font-semibold text-lg mb-2">Quick Quiz</h4>
                    <div id="quizContainer"></div>
                    <div id="quizFeedback" class="mt-4 font-medium text-center"></div>
                    <button id="nextQuestion" class="mt-4 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition hidden">Next Question</button>
                </div>
            </section>

            <!-- Card 8: Common Mistakes -->
            <section id="part6" class="lesson-card" data-step="8">
                <h3 class="text-2xl font-semibold mb-4 text-gray-900">Part 7: Common Mistakes</h3>
                <p>Understanding taxes helps you budget and avoid costly errors. Here are some key takeaways.</p>
                <div class="interactive-section grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-green-100 text-green-800 p-4 rounded-lg">
                        <h4 class="font-bold text-lg">✅ Do This:</h4>
                        <ul class="list-disc list-inside mt-2 space-y-1">
                            <li>File a tax return, even for a small income (it's the only way to get a refund of taxes you overpaid!).</li>
                            <li>Fill out your W-4 carefully.</li>
                            <li>Keep your W-2 forms in a safe place.</li>
                        </ul>
                    </div>
                    <div class="bg-red-100 text-red-800 p-4 rounded-lg">
                        <h4 class="font-bold text-lg">❌ Avoid This:</h4>
                        <ul class="list-disc list-inside mt-2 space-y-1">
                            <li>Forgetting to report side hustle income.</li>
                            <li>Missing the April 15th deadline.</li>
                            <li>Thinking a refund is "free money."</li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <!-- Card 9: Final Tally -->
            <section class="lesson-card" data-step="9">
                <h3 class="text-2xl font-semibold mb-4 text-gray-900">Lesson Summary & Score</h3>
                <p class="mb-4">Great job working through the material. Here's how you did on the knowledge check quiz.</p>
                <div class="interactive-section text-center">
                    <h4 class="font-semibold text-2xl mb-2">Your Quiz Score</h4>
                    <p class="text-5xl font-bold text-blue-600">
                        <span id="finalScore">0</span> / <span id="totalQuestions">0</span>
                    </p>
                    <p class="mt-4 text-gray-600">This score helps you see which areas you've mastered and what you might want to review. Feel free to go back through the lesson using the "Previous" button.</p>
                </div>
            </section>

            <!-- Card 10: Finish -->
            <section class="lesson-card" data-step="10">
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-gray-900">Congratulations!</h2>
                    <p class="mt-4 text-lg text-gray-600">You've completed the Taxes 101 lesson. You now have a solid foundation for understanding how your pay and taxes work.</p>
                    <p class="mt-4 text-gray-600">You can use the "Previous" button to review any topic.</p>
                </div>
            </section>
        </div>

        <!-- Navigation Buttons -->
        <div class="flex justify-between w-full max-w-3xl mt-4">
            <button id="prevBtn" class="nav-button secondary">Previous</button>
            <button id="nextBtn" class="nav-button">Start</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- State Management ---
            let selectedPersonaKey = 'student'; // Default persona

            // --- Persona Data ---
            const personas = {
                student: { name: "Student Worker", weeklyPay: 150, annualIncome: 7800, color: "bg-green-50 border-green-200 text-green-800", story: "Maria works part-time. Although she earns less than the filing requirement, her employer might still withhold some income tax. She <strong>should file a tax return</strong> to get that money back as a full refund." },
                cashier: { name: "Full-Time Cashier", weeklyPay: 575, annualIncome: 29900, color: "bg-blue-50 border-blue-200 text-blue-800", story: "Alex works full-time. His weekly paycheck shows clear deductions for Federal tax, State tax, and FICA. What's left over is his 'take-home' pay." },
                salary: { name: "Salaried Employee", weeklyPay: 1440, annualIncome: 74880, color: "bg-yellow-50 border-yellow-200 text-yellow-800", story: "Jamal gets a consistent salary. His paycheck has the usual tax deductions, plus others like health insurance and a 401(k) retirement contribution." },
                professional: { name: "High Earner", weeklyPay: 2692, annualIncome: 139984, color: "bg-purple-50 border-purple-200 text-purple-800", story: "Priya earns a high salary ($140k/year). A significant portion of her large paycheck is withheld for federal and state taxes because her income falls into higher tax brackets." }
            };

            const personaTaxData = {
                student: { name: "Student Worker", initialTax: 0, marginalRate: 0.10 },
                cashier: { name: "Full-Time Cashier", initialTax: 1844, marginalRate: 0.12 },
                salary: { name: "Salaried Employee", initialTax: 8907, marginalRate: 0.22 },
                professional: { name: "High Earner", initialTax: 23627, marginalRate: 0.24 }
            };


            // --- Lesson Flow Logic ---
            const lessonCards = document.querySelectorAll('.lesson-card');
            const nextBtn = document.getElementById('nextBtn');
            const prevBtn = document.getElementById('prevBtn');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            let currentStep = 0;
            const totalSteps = lessonCards.length;

            function showStep(stepIndex) {
                lessonCards.forEach((card, index) => card.classList.toggle('active-card', index === stepIndex));
                const progressPercentage = ((stepIndex + 1) / totalSteps) * 100;
                progressBar.style.width = `${progressPercentage}%`;
                progressText.textContent = `Step ${stepIndex + 1} of ${totalSteps}`;
                prevBtn.style.visibility = stepIndex === 0 ? 'hidden' : 'visible';

                if (stepIndex === 0) nextBtn.textContent = 'Start';
                else if (stepIndex === totalSteps - 1) nextBtn.textContent = 'Finish';
                else nextBtn.textContent = 'Next';

                if (stepIndex === 5) showPersonaBrackets(selectedPersonaKey); // Tax Brackets card
                if (stepIndex === 6) updateDeductionsCard(selectedPersonaKey); // Deductions card
                if (stepIndex === 7) { // Quiz card
                    currentQuestionIndex = 0;
                    score = 0;
                    loadQuestion();
                }
            }

            nextBtn.addEventListener('click', () => {
                if (currentStep < totalSteps - 1) {
                    currentStep++;
                    showStep(currentStep);
                }
            });
            prevBtn.addEventListener('click', () => {
                if (currentStep > 0) {
                    currentStep--;
                    showStep(currentStep);
                }
            });

            // --- Paycheck Estimator (Card 2) ---
            const grossPayInput = document.getElementById('grossPay');
            const calculatePayBtn = document.getElementById('calculatePay');
            const paycheckError = document.getElementById('paycheck-error');
            const paycheckResultDiv = document.getElementById('paycheckResult');
            
            function runPaycheckCalculation() {
                const gross = parseFloat(grossPayInput.value) || 0;
                if (gross <= 0) {
                    paycheckError.classList.remove('hidden');
                    paycheckResultDiv.classList.add('hidden');
                    return;
                }
                paycheckError.classList.add('hidden');
                const annualIncome = gross * 52;
                const taxableIncome = Math.max(0, annualIncome - 14600);
                let federalTaxAnnual = 0;
                if (taxableIncome > 100525) federalTaxAnnual = 17400.50 + (taxableIncome - 100525) * 0.24;
                else if (taxableIncome > 47150) federalTaxAnnual = 5335.50 + (taxableIncome - 47150) * 0.22;
                else if (taxableIncome > 11600) federalTaxAnnual = 1160 + (taxableIncome - 11600) * 0.12;
                else federalTaxAnnual = taxableIncome * 0.10;
                const fed = federalTaxAnnual / 52;
                const ss = gross * 0.062;
                const medicare = gross * 0.0145;
                const state = gross * 0.04;
                const net = gross - ss - medicare - fed - state;
                document.getElementById('resultGross').textContent = `$${gross.toFixed(2)}`;
                document.getElementById('resultSS').textContent = `$${ss.toFixed(2)}`;
                document.getElementById('resultMedicare').textContent = `$${medicare.toFixed(2)}`;
                document.getElementById('resultFed').textContent = `$${fed.toFixed(2)}`;
                document.getElementById('resultState').textContent = `$${state.toFixed(2)}`;
                document.getElementById('resultNet').textContent = `$${net.toFixed(2)}`;
                paycheckResultDiv.classList.remove('hidden');
            }
            calculatePayBtn.addEventListener('click', runPaycheckCalculation);

            // --- Payroll Persona Tabs (Card 2) ---
            const personaTabsContainerPayroll = document.getElementById('persona-tabs-payroll');
            const personaContentPayroll = document.getElementById('persona-content-payroll');
            
            function showPersonaPayroll(personaKey) {
                selectedPersonaKey = personaKey;
                const personaData = personas[personaKey];
                personaContentPayroll.innerHTML = `<div class="p-4 rounded-lg border ${personaData.color}"><h5 class="font-bold">${personaData.name} (~$${(personaData.annualIncome).toLocaleString()}/yr)</h5><p class="mt-2 text-sm">${personaData.story}</p></div>`;
                personaTabsContainerPayroll.querySelectorAll('.persona-tab').forEach(tab => tab.classList.toggle('active', tab.dataset.persona === personaKey));
                grossPayInput.value = personaData.weeklyPay;
                paycheckResultDiv.classList.add('hidden');
                paycheckError.classList.add('hidden');
            }
            personaTabsContainerPayroll.addEventListener('click', e => { if (e.target.classList.contains('persona-tab')) showPersonaPayroll(e.target.dataset.persona); });

            // --- Tax Bracket Visualizer (Card 5) ---
            const incomeSlider = document.getElementById('incomeSlider');
            const incomeValue = document.getElementById('incomeValue');
            const totalTaxEl = document.getElementById('totalTax');
            const effectiveRateEl = document.getElementById('effectiveRate');
            const bracketsContainer = document.getElementById('taxBracketsViz');
            const personaTabsBrackets = document.getElementById('persona-tabs-brackets');
            const brackets2025 = [
                { rate: 0.10, min: 0, max: 11600, label: '10%' }, { rate: 0.12, min: 11600, max: 47150, label: '12%' },
                { rate: 0.22, min: 47150, max: 100525, label: '22%' }, { rate: 0.24, min: 100525, max: 191950, label: '24%' },
            ];
            
            function updateTaxVisualizer() {
                const income = parseFloat(incomeSlider.value);
                incomeValue.textContent = income.toLocaleString();
                let totalTax = 0;
                bracketsContainer.innerHTML = '';
                const incomeInDeduction = Math.min(income, 14600);
                const deductionFill = (incomeInDeduction / 14600) * 100;
                bracketsContainer.innerHTML += `<div class="flex-1 p-2 bg-gray-200 rounded-lg min-w-[120px]"><div class="flex justify-between text-sm font-semibold"><span>0%</span><span>$${incomeInDeduction.toLocaleString()}</span></div><div class="w-full bg-gray-300 rounded-full h-4 mt-1"><div class="bg-green-500 h-4 rounded-full" style="width: ${deductionFill}%"></div></div><div class="text-xs text-center mt-1 text-gray-600">Std. Deduction</div></div>`;
                const taxableIncome = Math.max(0, income - 14600);
                let remainingTaxableIncome = taxableIncome;
                brackets2025.forEach(bracket => {
                    const bracketSize = bracket.max - bracket.min;
                    const incomeInBracket = Math.min(remainingTaxableIncome, bracketSize);
                    remainingTaxableIncome -= incomeInBracket;
                    const taxInBracket = incomeInBracket * bracket.rate;
                    totalTax += taxInBracket;
                    const fillPercentage = bracketSize > 0 ? (incomeInBracket / bracketSize) * 100 : 0;
                    bracketsContainer.innerHTML += `<div class="flex-1 p-2 bg-gray-200 rounded-lg min-w-[120px]"><div class="flex justify-between text-sm font-semibold"><span>${bracket.label}</span><span>$${incomeInBracket.toLocaleString()}</span></div><div class="w-full bg-gray-300 rounded-full h-4 mt-1"><div class="bg-blue-500 h-4 rounded-full" style="width: ${fillPercentage}%"></div></div><div class="text-xs text-center mt-1 text-gray-600">$${taxInBracket.toFixed(2)} tax</div></div>`;
                });
                const effectiveRate = income > 0 ? (totalTax / income) * 100 : 0;
                totalTaxEl.textContent = `$${totalTax.toFixed(2)}`;
                effectiveRateEl.textContent = `${effectiveRate.toFixed(2)}%`;
            }
            incomeSlider.addEventListener('input', updateTaxVisualizer);

            function showPersonaBrackets(personaKey) {
                selectedPersonaKey = personaKey;
                const personaData = personas[personaKey];
                personaTabsBrackets.querySelectorAll('.persona-tab').forEach(tab => tab.classList.toggle('active', tab.dataset.persona === personaKey));
                incomeSlider.value = personaData.annualIncome;
                updateTaxVisualizer();
            }
            personaTabsBrackets.addEventListener('click', e => { if(e.target.classList.contains('persona-tab')) showPersonaBrackets(e.target.dataset.persona); });


            // --- Deductions & Credits (Card 6) ---
            const personaTabsDeductions = document.getElementById('persona-tabs-deductions');
            const deductionsContent = document.getElementById('deductions-persona-content');
            const deductionsTitle = document.getElementById('deductions-title');
            
            function updateDeductionsCard(personaKey) {
                const persona = personaTaxData[personaKey];
                selectedPersonaKey = personaKey;
                deductionsTitle.textContent = `Part 5: Deductions & Credits for the ${persona.name}`;
                personaTabsDeductions.querySelectorAll('.persona-tab').forEach(tab => tab.classList.toggle('active', tab.dataset.persona === personaKey));
                let contentHTML;
                if (persona.initialTax === 0) {
                    contentHTML = `<div class="text-center p-4"><h4 class="font-semibold text-lg">No Initial Tax Bill</h4><p class="mt-2 text-gray-600">Because the ${persona.name}'s income is below the Standard Deduction, their estimated federal income tax is $0. Deductions and credits wouldn't change this.</p></div>`;
                } else {
                    const deductionValue = 1000 * persona.marginalRate;
                    const taxAfterDeduction = persona.initialTax - deductionValue;
                    const taxAfterCredit = persona.initialTax - 1000;
                    contentHTML = `
                        <p class="text-center font-semibold text-lg">Initial Estimated Tax Bill: <span class="text-blue-600">$${persona.initialTax.toLocaleString()}</span></p>
                        <div class="flex flex-col md:flex-row gap-4 mt-4">
                            <div class="flex-1 p-4 bg-white rounded-lg shadow-inner">
                                <h5 class="font-bold text-center">Apply a $1,000 DEDUCTION</h5>
                                <p class="text-sm text-center text-gray-600">(Reduces taxable income)</p>
                                <p class="text-center text-2xl font-bold text-orange-500 mt-2">Saves ~$${deductionValue.toFixed(0)}</p>
                                <p class="text-center font-semibold mt-2">New Tax Bill: $${taxAfterDeduction.toLocaleString()}</p>
                            </div>
                            <div class="flex-1 p-4 bg-white rounded-lg shadow-inner">
                                <h5 class="font-bold text-center">Apply a $1,000 CREDIT</h5>
                                <p class="text-sm text-center text-gray-600">(Reduces final tax bill)</p>
                                <p class="text-center text-2xl font-bold text-teal-500 mt-2">Saves $1,000</p>
                                <p class="text-center font-semibold mt-2">New Tax Bill: $${taxAfterCredit.toLocaleString()}</p>
                            </div>
                        </div>`;
                }
                deductionsContent.innerHTML = contentHTML;
            }
            personaTabsDeductions.addEventListener('click', e => { if(e.target.classList.contains('persona-tab')) updateDeductionsCard(e.target.dataset.persona); });
            

            // --- Quiz (Card 7) ---
            const quizData = [
                { question: "What is the main deadline to file your federal taxes?", options: ["January 31st", "April 15th", "December 31st"], answer: "April 15th" },
                { question: "Which form does your employer send you to show your annual earnings and taxes paid?", options: ["W-4", "1040", "W-2"], answer: "W-2" },
                { question: "Which is more powerful for reducing your tax bill?", options: ["A $500 tax deduction", "A $500 tax credit"], answer: "A $500 tax credit" },
                { question: "If you get a tax refund, it means...", options: ["You got free money from the government.", "You paid more tax than you owed.", "You didn't earn enough to pay taxes."], answer: "You paid more tax than you owed." }
            ];
            let currentQuestionIndex = 0;
            let score = 0;
            const quizContainer = document.getElementById('quizContainer');
            const quizFeedback = document.getElementById('quizFeedback');
            const nextQuestionBtn = document.getElementById('nextQuestion');

            function loadQuestion() {
                const currentQuestion = quizData[currentQuestionIndex];
                quizFeedback.textContent = '';
                nextQuestionBtn.classList.add('hidden');
                quizContainer.innerHTML = `<p class="font-medium mb-4">${currentQuestion.question}</p><div class="space-y-2">${currentQuestion.options.map(option => `<div class="quiz-option p-3 bg-white rounded-md border-2 border-gray-200 hover:bg-gray-100 transition">${option}</div>`).join('')}</div>`;
                quizContainer.querySelectorAll('.quiz-option').forEach(option => option.addEventListener('click', selectAnswer));
            }

            function selectAnswer(e) {
                const selectedOption = e.target;
                const answer = quizData[currentQuestionIndex].answer;
                const allOptions = quizContainer.querySelectorAll('.quiz-option');
                allOptions.forEach(opt => opt.style.pointerEvents = 'none');
                if (selectedOption.textContent.trim() === answer) {
                    selectedOption.classList.add('correct');
                    quizFeedback.textContent = "Correct! Great job.";
                    quizFeedback.style.color = '#16a34a';
                    score++;
                } else {
                    selectedOption.classList.add('incorrect');
                    quizFeedback.textContent = `Not quite. The correct answer is: ${answer}`;
                    quizFeedback.style.color = '#dc2626';
                    allOptions.forEach(opt => { if (opt.textContent.trim() === answer) opt.classList.add('correct'); });
                }
                nextQuestionBtn.textContent = (currentQuestionIndex < quizData.length - 1) ? 'Next Question' : 'Finish Quiz';
                nextQuestionBtn.classList.remove('hidden');
            }
            nextQuestionBtn.addEventListener('click', () => {
                if (currentQuestionIndex < quizData.length - 1) {
                    currentQuestionIndex++;
                    loadQuestion();
                } else {
                    quizFeedback.textContent = "Quiz complete! You can now move to the next section.";
                    quizFeedback.style.color = '#1d4ed8';
                    nextQuestionBtn.classList.add('hidden');
                    document.getElementById('finalScore').textContent = score;
                    document.getElementById('totalQuestions').textContent = quizData.length;
                }
            });

            // --- Initial Load ---
            showStep(currentStep);
            showPersonaPayroll('student');
        });
    </script>
</body>
</html>


